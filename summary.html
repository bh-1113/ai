<script>
  async function uploadAndSummarize() {
    const fileInput = document.getElementById("fileInput");
    const exportType = document.getElementById("exportType").value;
    const resultDiv = document.getElementById("summaryResult");

    if (!fileInput.files.length) {
      alert("파일을 선택하세요!");
      return;
    }

    resultDiv.style.display = "block";
    resultDiv.innerText = "⏳ 요약 중... 잠시만 기다려주세요.";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    formData.append("export", exportType);

    try {
      // 🔹 Render API 절대경로
      const response = await fetch("https://ai-report-api-m1vs.onrender.com/upload_summary", {
        method: "POST",
        body: formData
      });

      if (!response.ok) {
        resultDiv.innerText = "⚠️ 요약 실패 (서버 오류)";
        return;
      }

      if (exportType === "json") {
        const data = await response.json();
        resultDiv.innerText = data.summary;
      } else {
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = exportType === "docx" ? "summary.docx" : "summary.pptx";
        document.body.appendChild(a);
        a.click();
        a.remove();
        resultDiv.innerText = "✅ 요약 파일이 다운로드되었습니다.";
      }
    } catch (err) {
      resultDiv.innerText = "❌ 서버 오류: " + err.message;
    }
  }
</script>
