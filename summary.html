<script>
  async function uploadAndSummarize() {
    const fileInput = document.getElementById("fileInput");
    const exportType = document.getElementById("exportType").value;
    const resultDiv = document.getElementById("summaryResult");

    if (!fileInput.files.length) {
      alert("íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”!");
      return;
    }

    resultDiv.style.display = "block";
    resultDiv.innerText = "â³ ìš”ì•½ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.";

    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    formData.append("export", exportType);

    try {
      // ğŸ”¹ Render API ì ˆëŒ€ê²½ë¡œ
      const response = await fetch("https://ai-report-api-m1vs.onrender.com/upload_summary", {
        method: "POST",
        body: formData
      });

      if (!response.ok) {
        resultDiv.innerText = "âš ï¸ ìš”ì•½ ì‹¤íŒ¨ (ì„œë²„ ì˜¤ë¥˜)";
        return;
      }

      if (exportType === "json") {
        const data = await response.json();
        resultDiv.innerText = data.summary;
      } else {
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = exportType === "docx" ? "summary.docx" : "summary.pptx";
        document.body.appendChild(a);
        a.click();
        a.remove();
        resultDiv.innerText = "âœ… ìš”ì•½ íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.";
      }
    } catch (err) {
      resultDiv.innerText = "âŒ ì„œë²„ ì˜¤ë¥˜: " + err.message;
    }
  }
</script>
